# Deep-B3
A multi-model framework for blood-brain barrier permeability discovery
## Dependencies

This repository has been tested on CentOS 7.5. We strongly recommend you to have [Anaconda3](https://www.anaconda.com/distribution/) installed, which contains most of required packages for running this model.

### Must installed packages or softwares

- [FastAI](https://docs.fast.ai/)  1.0.61

- [PyTorch](https://pytorch.org/) 1.9.0

- Torchvision 0.10.0

- Pandas 1.3.2

- Numpy 1.19.2

- RDKit 2020.09.1

## Get Started

### Generate features from the SMILES file and train a new deep-b3 model
- SMILES file is a csv format, within head (id,smi, label)
- The train and test feature file was stored in `./train` and `./test`, respectively.
- The iamges for training and testing the model were stored in `./train_images` and `./test_images`, respectively.
- You can run the script `make_feature.py` to generate features for your train data.  Sample code:
```
python make_feature.py --smifile train.csv --outfile train_feature.csv [--is_balance]
```
- if is_balance, the data will be balanced by multiple SMILES-Based Augmentation method
- if is test data, then the test feature are generated by 
```
python make_feature.py --smifile test.csv --outfile test_feature.csv --is_test
```

### train a new deep-b3 model on your data
- You can run the script `deep-b3.py` to train a new model for the data or on your new data, and the models will be stored in `./models`.  Sample code:
```
python deep-b3.py train --train_feature train.csv --test_feature test.csv --bs 64 --vis_out 512 --text_out 128
```

### test the pre-trian deep-b3 model on the test data
- You can run the script `deep-b3-test.py` to test the pre-trained model on the test data used in this study, the results are stored in file `result.csv`.  Sample code:
```
python deep-b3-test.py -model model-choices
```
- model-choices: you can choice one in the 'tab', 'img', 'text', 'tab_img', 'tab_text', 'img_text', 'deep-b3', or given the 'all' for test all those models.

### test the pre-trian deep-b3 model on your data
- there need a feature file within id, smi and all the features inculding 208 molecular descriptors, 167 bit MACCS and 1024 Morgan fingerprints, and the graphs are stored in a directory, the image name should correspond to the id in the feature file.
