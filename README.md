# Deep-B3
A multi-model framework for blood-brain barrier permeability discovery
## Dependencies

This repository has been tested on CentOS 7.5. We strongly recommend you to have [Anaconda3](https://www.anaconda.com/distribution/) installed, which contains most of required packages for running this model.

### Must installed packages or softwares

- [FastAI](https://docs.fast.ai/)  1.0.61

- [PyTorch](https://pytorch.org/) 1.9.0

- Torchvision 0.10.0

- Pandas 1.3.2

- Numpy 1.19.2

- RDKit 2020.09.1

## Get Started

### Generate features from the SMILES file and train a new deep-b3 model
- SMILES file is a csv format, within head (id,smi, label)
- The train and test feature file was stored in `./train` and `./test`, respectively.
- The iamges for training and testing the model were stored in `./train_images` and `./test_images`, respectively.
- You can run the script `make_feature.py` to generate features for your train data.  Sample code:
```
python make_feature.py --smifile train.csv --outfile train_feature.csv [--is_balance]
```
- if is_balance, the data will be balanced by multiple SMILES-Based Augmentation method
- if is test data, then the test feature are generated by 
```
python make_feature.py --smifile test.csv --outfile test_feature.csv --is_test
```

### train a new deep-b3 model on your data
- You can run the script `deep-b3.py` to train a new model for the data or on your new data, and the models will be stored in `./models`.  Sample code:<br/>
`1. train a model including image, tabular and text features, and the features output from the CNN is n and NLP is m `<br/>
`python train.py train --feature train.csv --epoch 50 --bs 64 --vis_out n --text_out m`<br/>
`2. train a model based on only image, and the features output from the CNN is m `<br/>
`python train.py train --feature train.csv --epoch 50 --bs 64 --vis_out m --has_tab False --has_text False`<br/>
`3. train a model based on only text, and the features output from the NLP is m `<br/>
`python train.py train --feature train.csv --epoch 50 --bs 64 --text_out m --has_tab False --has_img False`<br/>
`4. train a model based on only tabular`<br/>
`python train.py train --feature train.csv --epoch 50 --bs 64 --has_img False --has_text False`<br/>
and so on...
### test the pre-trian deep-b3 model on the test data
- You can run the script `train.py` to test the pre-trained model on the test data used in this study.  Sample code:
```
python train.py test --feature test_feature.csv
```
